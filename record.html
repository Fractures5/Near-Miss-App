<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Record Near-miss</title>
      <link rel = "icon" type = "image/png" href = "./images/logo.png">
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">
      <script type="text/javascript" src="https://unpkg.com/webcam-easy/dist/webcam-easy.min.js"></script>
      <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
      <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet" />
      <link href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/4.2.0/mdb.min.css" rel="stylesheet" />
      <link rel="stylesheet" href="./styles/style.css">
      <script src="https://kit.fontawesome.com/yourcode.js" crossorigin="anonymous"></script>
      <script type="text/javascript" src="xhr.js"></script>
      <script type="text/javascript" src="ajaxRecordForm.js"></script>
      <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
      <script type="text/javascript">
         $(document).ready(function () 
         {
             resetForm();
             console.log($(document));
         })
         
         function submit()
         {
         
         }
         
         function cancelForm()
         {
             
         }
         
         function verify()
         {
         
         }
         
      </script>
   </head>
   <body>
      <header>
         <!-- Navbar -->
         <nav class="navbar fixed-top navbar-expand-lg navbar-light bg-light">
            <div class="container-fluid">
               <nav aria-label="breadcrumb">
                  <ol class="breadcrumb">
                     <li>
                        <a href="index.html">
                           <div class="sub-menu">
                              <i class="bi bi-house-door"></i>
                              <p class="menu-title">Home</p>
                           </div>
                        </a>
                     </li>
                     <li>
                        <a href="index.html#about-section">
                           <div class="sub-menu">
                              <i class="bi bi-info-square"></i>
                              <p class="menu-title">About</p>
                           </div>
                        </a>
                     </li>
                     <li>
                        <a href="index.html#contact-section">
                           <div class="sub-menu">
                              <i class="bi bi-chat-left-text"></i>
                              <p class="menu-title">Contact</p>
                           </div>
                        </a>
                     </li>
                     <li>
                        <a href="adminlogin.html">
                           <div class="sub-menu">
                              <i class="bi bi-person-circle"></i>
                              <p class="menu-title">Admin</p>
                           </div>
                        </a>
                     </li>
                     <li>
                        <a href="record.html">
                           <div class="sub-menu">
                              <i class="bi bi-pencil-square"></i>
                              <p class="menu-title">Record</p>
                           </div>
                        </a>
                     </li>
                  </ol>
               </nav>
            </div>
         </nav>
         <!-- Navbar -->
      </header>
      <!-- Navbar -->
      <!-- Background image -->
      <div class = "record-case-container">
         <br><br><br><br>
         <h1 style="color: white;">Record a Near-miss</h1>
         <div class="form-group">
            <form action="recordInfo.php" method="POST" enctype="multipart/form-data">
               <div>
                  <i class="fa-solid fa-location-dot" style="color: white;"></i>
                  <label for="siteLocation" style="color: white;">Site Location</label>
                  <br><input type="text" id="nmSiteLocation" name="nmSiteLocation"
                     placeholder="Enter Site Location..."><br>
                  <span id="errSiteLocation" style="color: red; display: none"></span>
               </div>
               <div>
                  <p></p><label for="location" style="color: white;">In-Site location</label>
                  <br><input type="text" id="nmInSiteLocation" name="nmInSiteLocation"
                     placeholder="Enter in-site description...">
               </div>
               <div id="upload-image">
                  <label for="uploadImage">Select files:</label>
                  <div id="choose-files">
                     <input type="file" id="uploaded-image" accept="image/jpeg, image/png, image/jpg" name="uploadedImageFile"
                        onchange=showImagePreviewBox() multiple required>
                  </div>
                  <br>
                  <h3 id="image-preview-title" style="display:none">Uploaded Image Preview</h3>
                  <div id="show-uploaded-image" style="display:none">
                  </div>
                  <div class="take-webcam-photos">
                     <p><button onclick="showTakePhotoOption()">Toggle Take Webcam Photo</button></p>
                     <div id="take-photo-container" style="display:none">
                        <h3>Preview</h3>
                        <video id="webCamera" autoplay playsinlne width="500" height="400"></video>
                        <h3>Image Taken & Downloaded</h3>
                        <canvas id="photoCanvas"></canvas>
                        <br>
                        <a class="download-button" onClick="takePhoto()" download>Take Photo</a>
                     </div>
                  </div>
                  <br>
               </div>
               <script type ="text/javascript" src="camera-image-functions.js"></script>
               <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/4.2.0/mdb.min.js"></script>
         </div>
         <div>
         <i class="fa-solid fa-note-sticky" style="color: white;"></i>
         <label for="description" style="color: white;">Description</label>
         <br><textarea id="description" name="description" rows="4" cols="50" required></textarea>
         <span id="errImage" style="color: red; display: none"></span>
         <form>
            <fieldset>
               <legend>Fill Out Form With Speech Recognition (Chrome)</legend>
               <code id="result">live transcript here ...</code>
               <button type="button" id="toggle">Toggle listening</button>
               <p>Click on “Toggle listening”, then click on the form field, where you want to insert speeched text. Pause a
                  bit after a sentence to process the speech-data. This demo only works with language
                  <strong>“en-US”</strong>, only in Chrome, and only if you allow the microphone on this page!
               </p>
               <label>Description<br><textarea></textarea></label>
            </fieldset>
         </form>
         <!-- <style>
            button {
               background-color: hsl(90, 50%, 30%);
               border: 0;
               color: hsl(90, 50%, 95%);
               margin-block-start: var(--gap);
               padding: calc(var(--gap) / 2) var(--gap);
            }
         
            button.listening {
               background-color: hsl(0, 50%, 50%);
               color: hsl(0, 50%, 95%);
            }
         
            code {
               background: #333;
               color: lime;
               display: block;
               padding: calc(var(--gap) / 2);
            }
         
            fieldset {
               background: #EEE;
               border: 1px solid #BBB;
               padding: var(--gap);
            }
         
            form {
               margin: 0 auto;
               max-width: 30rem;
            }
         
            input,
            textarea {
               border: 1px solid #BBB;
               display: block;
               padding: calc(var(--gap) / 2);
               resize: vertical;
               width: 100%;
            }
         
            label {
               display: block;
               font-weight: 500;
               margin-block-start: var(--gap);
            }
         
            p {
               font-size: small;
            }
         </style> -->
         
         <script>
            function init() {
               window.SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
               if (('SpeechRecognition' in window || 'webkitSpeechRecognition' in window)) {
                  let speech = {
                     enabled: true,
                     listening: false,
                     recognition: new window.SpeechRecognition(),
                     text: ''
                  }
                  speech.recognition.continuous = true;
                  speech.recognition.interimResults = true;
                  speech.recognition.lang = 'en-US';
                  speech.recognition.addEventListener('result', (event) => {
                     const audio = event.results[event.results.length - 1];
                     speech.text = audio[0].transcript;
                     const tag = document.activeElement.nodeName;
                     if (tag === 'INPUT' || tag === 'TEXTAREA') {
                        if (audio.isFinal) {
                           document.activeElement.value += speech.text;
                        }
                     }
                     result.innerText = speech.text;
                  });

                  toggle.addEventListener('click', () => {
                     speech.listening = !speech.listening;
                     if (speech.listening) {
                        toggle.classList.add('listening');
                        toggle.innerText = 'Listening ...';
                        speech.recognition.start();
                     }
                     else {
                        toggle.classList.remove('listening');
                        toggle.innerText = 'Toggle listening';
                        speech.recognition.stop();
                     }
                  })
               }
            }
            init();
         </script>
         </div>
         <div>
         <p></p><i class="fa-solid fa-clock" style="color: white;"></i>
         <label for="time" style="color: white;">Date and Time of Near-miss</label><br>
         <label for="dateTime"></label>
         <input type="datetime-local" id="dateTime" name="dateTime" onchange="checkForValidDate()">
         <span id="errImage" style="color: red; display: none"></span>
         </div>
         <div>
         </div>
         <br>
         <!-- <input type="button" id = "submit" value="Submit" name = "submit" onClick = "getData('recordInfo.php','nearMissInformation', description.value, dateTime.value, priority.value)"> -->
         <input type="submit" id = "submit" value="Submit" name = "submit">
         <input type="reset" value="Reset">
         </form>
      </div>
      <div id ="nearMissInformation">
      </div>
   </body>
   <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/4.2.0/mdb.min.js"></script>
   <script type="text/javascript" src="formValidation.js"></script>
</html>